# 18장 리덕스 미들웨어를 통한 비동기 작업 관리

리액트 웹 애플리케이션에서 API 서버를 연동할 때는 API 요청에 대한 상태도 잘 관리해야 한다. 예를 들어 요청이 시작되었을 때는 로딩 중임을, 요청이 성공하거나 실패했을 떄는 로딩이 끝났음을 명시해야 한다. 요청이 성공하면 서버에서 받아 온 응답에 대한 상태를 관리하고, 요청이 실패하면 서버에서 반환하 에러에 대한 상태를 관리해야 한다,

리액트 프로젝트에서 리덕스를 사용하고 있으며 이러한 비동기 작업을 관리해야 한다면, '미들웨어(middleware)'를 사용하여 매우 효율적이고 편하게 상태 관리를 할 수 있다. 이 장에서는 리덕스 미들웨어의 개념을 이해하고, 미들웨어를 사용하여 비동기 작업을 처리하는 방법에 대해 알아보도록 하자.

이번 실습은 다음과 같은 흐름으로 진행된다.

> 작업 환경 준비 → 미들웨어 직접 만들기 → redux-logger 사용하기→ 미들웨어를 사용한 비동기 작업 관리

## 18.1 작업 환경 준비

먼저 리덕스를 적용한 간단한 리액트 프로젝트를 만들어보자. 이 프로젝트를 통해 리덕스 미들웨어에 대해 알아볼 예정이다.

` $ yarn create react-app learn-redux-middleware`

다음으로 리덕스를 사용하여 카운터를 구현하는데 이에 필요한 라이브러리들을 설치해준다.

` $ yarn add redux react-redux redux-actions`

이제 리덕스를 위한 counter 모듈과 루트 리듀서, CounterContainer 컴포넌트를 작성해 준다.

```jsx
// counter 모듈
import { createAction, handleActions } from "redux-actions";

const INCREASE = "counter/INCREASE";
const DECREASE = "counter/DECREASE";

export const increase = createAction(INCREASE);
export const decrease = createAction(DECREASE);

const initialState = 0; // 상태는 꼭 객체일 필요는 없다.

const counter = handleActions(
  {
    [INCREASE]: (state) => state + 1,
    [DECREASE]: (state) => state - 1,
  },
  initialState
);

export default counter;
```

```jsx
// 루트 리듀서(modules/index.js)
import { combineReducers } from "redux";
import counter from "./couter";

const rootReducer = combineReducers({
  counter,
});

export default rootReducer;
```

```jsx
// Provider 적용(src/index.js)
import React from "react";
import ReactDOM from "react-dom";
import App from "./App";
import { createStore } from "redux";
import { Provider } from "react-redux";
import rootReducer from "./modules";

const store = createStore(rootReducer);

ReactDOM.render(
  <Provider store={store}>
    <App />
  </Provider>,
  document.getElementById("root")
);
```

```jsx
// 카운터 컴포넌트(components/Counter.js)
import React from "react";

const Counter = ({ onIncrease, onDecrease, number }) => {
  return (
    <div>
      <h1>{number}</h1>
      <button onClick={onIncrease}>+1</button>
      <button onClick={onDecrease}>-1</button>
    </div>
  );
};

export default Counter;
```

```jsx
// CounterContainer 컴포넌트
import React from "react";
import { connect } from "react-redux";
import Counter from "../components/Counter";
import { increase, decrease } from "../modules/couter";

const CounterContainer = ({ number, increase, decrease }) => {
  return (
    <Counter number={number} onIncrease={increase} onDecrease={decrease} />
  );
};

export default connect(
  (state) => ({
    number: state.counter,
  }),
  { increase, decrease }
)(CounterContainer);
```

다 작성한 뒤  App 컴포넌트 안에서 CounterContainer를 렌더링시켜주면 아래와 같이 나오는 것을 확인해볼 수 있다. 

<img src="./images/18_01.png" />

이제 모든 준비가 끝났고 본격적으로 리덕스 미들웨어를 배워보자!

## 18.2 미들웨어란?

